var ajaxChat={settingsInitiated:null,styleInitiated:null,initializeFunction:null,finalizeFunction:null,loginChannelID:null,loginChannelName:null,timerRate:null,timer:null,ajaxURL:null,baseURL:null,regExpMediaUrl:null,dirs:null,startChatOnLoad:null,chatStarted:null,domIDs:null,dom:null,settings:null,nonPersistentSettings:null,unusedSettings:null,bbCodeTags:null,colorCodes:null,emoticonCodes:null,emoticonFiles:null,soundFiles:null,sounds:null,soundTransform:null,sessionName:null,cookieExpiration:null,cookiePath:null,cookieDomain:null,cookieSecure:null,chatBotName:null,chatBotID:null,allowUserMessageDelete:null,inactiveTimeout:null,privateChannelDiff:null,privateMessageDiff:null,showChannelMessages:null,messageTextMaxLength:null,socketServerEnabled:null,socketServerHost:null,socketServerPort:null,socketServerChatID:null,socket:null,socketIsConnected:null,socketTimerRate:null,socketReconnectTimer:null,socketRegistrationID:null,userID:null,userName:null,userRole:null,channelID:null,channelName:null,channelSwitch:null,usersList:null,userNamesList:null,userMenuCounter:null,encodedUserName:null,userNodeString:null,ignoredUserNames:null,lastID:null,localID:null,lang:null,langCode:null,baseDirection:null,originalDocumentTitle:null,blinkInterval:null,httpRequest:null,retryTimer:null,retryTimerDelay:null,requestStatus:null,DOMbuffering:null,DOMbuffer:null,DOMbufferRowClass:null,inUrlBBCode:null,debug:null,init:function(e,t,s,i,n,a,r){this.httpRequest={},this.usersList=[],this.userNamesList=[],this.userMenuCounter=0,this.lastID=0,this.localID=0,this.lang=t,this.requestStatus="ok",this.DOMbufferRowClass="rowOdd",this.inUrlBBCode=!1,this.initConfig(e),this.initDirectories(),s&&this.initSettings(),i&&this.initStyle(),this.initializeFunction=a,this.finalizeFunction=r,n&&this.setLoadHandler()},initConfig:function(e){this.loginChannelID=e.loginChannelID,this.loginChannelName=e.loginChannelName,this.timerRate=e.timerRate,this.ajaxURL=e.ajaxURL,this.baseURL=e.baseURL,this.regExpMediaUrl=e.regExpMediaUrl,this.startChatOnLoad=e.startChatOnLoad,this.domIDs=e.domIDs,this.settings=e.settings,this.nonPersistentSettings=e.nonPersistentSettings,this.bbCodeTags=e.bbCodeTags,this.colorCodes=e.colorCodes,this.emoticonCodes=e.emoticonCodes,this.emoticonFiles=e.emoticonFiles,this.soundFiles=e.soundFiles,this.sessionName=e.sessionName,this.cookieExpiration=e.cookieExpiration,this.cookiePath=e.cookiePath,this.cookieDomain=e.cookieDomain,this.cookieSecure=e.cookieSecure,this.chatBotName=e.chatBotName,this.chatBotID=e.chatBotID,this.allowUserMessageDelete=e.allowUserMessageDelete,this.inactiveTimeout=Math.max(e.inactiveTimeout,2),this.privateChannelDiff=e.privateChannelDiff,this.privateMessageDiff=e.privateMessageDiff,this.showChannelMessages=e.showChannelMessages,this.messageTextMaxLength=e.messageTextMaxLength,this.socketServerEnabled=e.socketServerEnabled,this.socketServerHost=e.socketServerHost,this.socketServerPort=e.socketServerPort,this.socketServerChatID=e.socketServerChatID,this.debug=e.debug,this.DOMbuffering=!1,this.DOMbuffer="",this.retryTimerDelay=(6e3*this.inactiveTimeout-this.timerRate)/4+this.timerRate},initDirectories:function(){this.dirs={},this.dirs.emoticons=this.baseURL+"img/emoticons/",this.dirs.sounds=this.baseURL+"sounds/",this.dirs.flash=this.baseURL+"flash/"},initSettings:function(){var e,t,s,i,n,a,r=this.readCookie(this.sessionName+"_settings");if(this.settingsInitiated=!0,this.unusedSettings={},r)for(t=r.split("&"),e=0;e<t.length;e++)if(2===(s=t[e].split("=")).length){switch(i=s[0],n=this.decodeText(s[1])){case"true":n=!0;break;case"false":n=!1;break;case"null":n=null;break;default:a=parseFloat(n),isNaN(a)||(n=parseInt(a)===a?parseInt(a):a)}this.inArray(this.nonPersistentSettings,i)?this.unusedSettings[i]=n:this.settings[i]=n}},persistSettings:function(){var e;if(this.settingsInitiated){for(var t in e=[],this.settings){if(this.inArray(this.nonPersistentSettings,t)){if(!this.unusedSettings||!this.unusedSettings[t])continue;this.settings[t]=this.unusedSettings[t]}e.push(t+"="+this.encodeText(this.settings[t]))}this.createCookie(this.sessionName+"_settings",e.join("&"),this.cookieExpiration)}},getSettings:function(){return this.settings},getSetting:function(e){for(var t in this.settings)if(t===e)return this.settings[e];return null},setSetting:function(e,t){this.settings[e]=t},initializeSettings:function(){this.settings.persistFontColor&&this.settings.fontColor&&this.dom.inputField&&(this.dom.inputField.style.color=this.settings.fontColor)},initialize:function(){this.setUnloadHandler(),this.initializeDocumentNodes(),this.loadPageAttributes(),this.initEmoticons(),this.initColorCodes(),this.initializeSettings(),this.setSelectedStyle(),this.customInitialize(),this.setStatus("retrying"),"function"==typeof this.initializeFunction&&this.initializeFunction(),this.isCookieEnabled()?this.startChatOnLoad?this.startChat():(this.setStartChatHandler(),this.requestTeaserContent()):this.addChatBotMessageToChatList("/error CookiesRequired")},requestTeaserContent:function(){var e="&view=teaser";e+="&getInfos="+this.encodeText("userID,userName,userRole"),isNaN(parseInt(this.loginChannelID))?null!==this.loginChannelName&&(e+="&channelName="+this.encodeText(this.loginChannelName)):e+="&channelID="+this.loginChannelID,this.updateChat(e)},setStartChatHandler:function(){this.dom.inputField&&(this.dom.inputField.onfocus=function(){ajaxChat.startChat(),ajaxChat.dom.inputField.onfocus=""})},startChat:function(){this.chatStarted=!0,this.dom.inputField&&this.settings.autoFocus,this.loadFlashInterface(),this.startChatUpdate()},loadPageAttributes:function(){var e=document.getElementsByTagName("html")[0];this.langCode=e.getAttribute("lang")?e.getAttribute("lang"):"en",this.baseDirection=e.getAttribute("dir")?e.getAttribute("dir"):"ltr"},setLoadHandler:function(){var e=this;this.addEvent(window,"load",function(){e.initialize()})},setUnloadHandler:function(){var e=window.onunload;window.onunload="function"!=typeof e?function(){ajaxChat.finalize()}:function(){ajaxChat.finalize(),e()}},updateDOM:function(e,t,s,i){var n=this.dom[e]?this.dom[e]:document.getElementById(e);if(n)try{n.cloneNode(!1).innerHTML=t,i?n.innerHTML=t:s?n.innerHTML=t+n.innerHTML:n.innerHTML+=t}catch(t){this.DOMbuffer="",this.addChatBotMessageToChatList("/error DOMSyntax "+e),this.updateChatlistView()}},initializeDocumentNodes:function(){for(var e in this.dom={},this.domIDs)this.dom[e]=document.getElementById(this.domIDs[e])},initEmoticons:function(){this.DOMbuffer="";for(var e=0;e<this.emoticonCodes.length;e++)this.emoticonCodes[e]=this.encodeSpecialChars(this.emoticonCodes[e]),this.DOMbuffer=this.DOMbuffer+"<a href=\"javascript:ajaxChat.insertText('"+this.scriptLinkEncode(this.emoticonCodes[e])+'\');"><img src="'+this.dirs.emoticons+this.emoticonFiles[e]+'" alt="'+this.emoticonCodes[e]+'" title="'+this.emoticonCodes[e]+'"/></a>';this.dom.emoticonsContainer&&this.updateDOM("emoticonsContainer",this.DOMbuffer),this.DOMbuffer=""},initColorCodes:function(){if(this.dom.colorCodesContainer){this.DOMbuffer="";for(var e=0;e<this.colorCodes.length;e++)this.DOMbuffer=this.DOMbuffer+"<a href=\"javascript:ajaxChat.setFontColor('"+this.colorCodes[e]+'\');" style="background-color:'+this.colorCodes[e]+';" title="'+this.colorCodes[e]+'"></a>\n';this.updateDOM("colorCodesContainer",this.DOMbuffer),this.DOMbuffer=""}},startChatUpdate:function(){var e="userID,userName,userRole,channelID,channelName";this.socketServerEnabled&&(e+=",socketRegistrationID");var t="&getInfos="+this.encodeText(e);isNaN(parseInt(this.loginChannelID))?null!==this.loginChannelName&&(t+="&channelName="+this.encodeText(this.loginChannelName)):t+="&channelID="+this.loginChannelID,this.updateChat(t)},updateChat:function(e){var t=this.ajaxURL+"&lastID="+this.lastID;e&&(t+=e),this.makeRequest(t,"GET",null)},loadFlashInterface:function(){},flashInterfaceLoadCompleteHandler:function(){},initializeFlashInterface:function(){this.socketServerEnabled&&(this.socketTimerRate=60*(this.inactiveTimeout-1)*1e3,this.socketConnect()),this.loadSounds()},socketConnect:function(){if(!this.socketIsConnected)try{!this.socket&&FABridge.ajaxChat&&(this.socket=FABridge.ajaxChat.create("flash.net.XMLSocket"),this.socket.addEventListener("connect",this.socketConnectHandler),this.socket.addEventListener("close",this.socketCloseHandler),this.socket.addEventListener("data",this.socketDataHandler),this.socket.addEventListener("ioError",this.socketIOErrorHandler),this.socket.addEventListener("securityError",this.socketSecurityErrorHandler)),this.socket.connect(this.socketServerHost,this.socketServerPort)}catch(e){this.debugMessage("socketConnect",e)}clearTimeout(this.socketReconnectTimer),this.socketReconnectTimer=null},socketConnectHandler:function(e){ajaxChat.socketIsConnected=!0,setTimeout(ajaxChat.socketRegister,0)},socketCloseHandler:function(e){ajaxChat.socketIsConnected=!1,ajaxChat.socket&&(clearTimeout(ajaxChat.timer),ajaxChat.updateChat(null))},socketDataHandler:function(e){ajaxChat.socketUpdate(e.getData())},socketIOErrorHandler:function(e){setTimeout(function(){ajaxChat.addChatBotMessageToChatList("/error SocketIO")},0),setTimeout(ajaxChat.updateChatlistView,1)},socketSecurityErrorHandler:function(e){setTimeout(function(){ajaxChat.addChatBotMessageToChatList("/error SocketSecurity")},0),setTimeout(ajaxChat.updateChatlistView,1)},socketRegister:function(){if(this.socket&&this.socketIsConnected)try{this.socket.send('<register chatID="'+this.socketServerChatID+'" userID="'+this.userID+'" regID="'+this.socketRegistrationID+'"/>')}catch(e){this.debugMessage("socketRegister",e)}},loadXML:function(e){if(!arguments.callee.parser)try{arguments.callee.parser=new DOMParser}catch(e){var t=function(){};"Microsoft Internet Explorer"===navigator.appName?t.prototype.parseFromString=function(e,t){return arguments.callee.XMLDOM||(arguments.callee.XMLDOM=new ActiveXObject("Microsoft.XMLDOM")),arguments.callee.XMLDOM.loadXML(e),arguments.callee.XMLDOM}:t.prototype.parseFromString=function(e,t){return arguments.callee.httpRequest||(arguments.callee.httpRequest=new XMLHttpRequest),arguments.callee.httpRequest.open("GET","data:text/xml;charset=utf-8,"+encodeURIComponent(e),!1),arguments.callee.httpRequest.send(null),arguments.callee.httpRequest.responseXML},arguments.callee.parser=new t}return arguments.callee.parser.parseFromString(e,"text/xml")},socketUpdate:function(e){var t=this.loadXML(e);if(t&&(this.handleOnlineUsers(t.getElementsByTagName("user")),(this.showChannelMessages||"1"!==t.firstChild.getAttribute("mode"))&&!this.channelSwitch)){var s=t.firstChild.getAttribute("channelID");s!==this.channelID&&parseInt(s)!==parseInt(this.userID)+this.privateMessageDiff||this.handleChatMessages(t.getElementsByTagName("message"))}},setAudioVolume:function(e){if(e=parseFloat(e),!isNaN(e)){e<0?e=0:e>1&&(e=1),this.settings.audioVolume=e;try{this.soundTransform||(this.soundTransform=FABridge.ajaxChat.create("flash.media.SoundTransform")),this.soundTransform.setVolume(e)}catch(e){this.debugMessage("setAudioVolume",e)}}},loadSounds:function(){try{var e,t;for(var s in this.setAudioVolume(this.settings.audioVolume),this.sounds={},this.soundFiles)(e=FABridge.ajaxChat.create("flash.media.Sound")).addEventListener("complete",this.soundLoadCompleteHandler),e.addEventListener("ioError",this.soundIOErrorHandler),(t=FABridge.ajaxChat.create("flash.net.URLRequest")).setUrl(this.dirs.sounds+this.soundFiles[s]),e.load(t)}catch(e){this.debugMessage("loadSounds",e)}},soundLoadCompleteHandler:function(e){var t=e.getTarget();for(var s in ajaxChat.soundFiles)new RegExp(ajaxChat.soundFiles[s]).test(t.getUrl())&&(ajaxChat.sounds[s]=t)},soundIOErrorHandler:function(e){setTimeout(function(){ajaxChat.addChatBotMessageToChatList("/error SoundIO")},0),setTimeout(ajaxChat.updateChatlistView,1)},soundPlayCompleteHandler:function(e){},playSound:function(e){if(new Audio("sounds/"+e+".mp3").play(),this.sounds&&this.sounds[e])try{return this.sounds[e].play(0,0,this.soundTransform)}catch(e){this.debugMessage("playSound",e)}return null},playSoundOnNewMessage:function(e,t,s,i,n,a,r,o){var l;if(this.settings.audio&&this.lastID&&!this.channelSwitch){if(!1===this.customSoundOnNewMessage(e,t,s,i,n,a,r,o))return;switch(l=a.split(" ",1),t){case this.chatBotID:switch(l[0]){case"/login":case"/channelEnter":this.playSound(this.settings.soundEnter);break;case"/logout":case"/channelLeave":case"/kick":this.playSound(this.settings.soundLeave);break;case"/error":this.playSound(this.settings.soundError);break;default:this.playSound(this.settings.soundChatBot)}break;case this.userID:switch(l[0]){case"/privmsgto":this.playSound(this.settings.soundPrivate);break;default:this.playSound(this.settings.soundSend)}break;default:switch(l[0]){case"/privmsg":this.playSound(this.settings.soundPrivate);break;default:this.playSound(this.settings.soundReceive)}}var h=setTimeout(function(){;"default"});Notification.requestPermission(function(e){clearTimeout(h),e}),new Notification(s,{tag:r,body:a}).onerror=function(){console.log("permission state = default or denied")}}},fillSoundSelection:function(e,t){var s=document.getElementById(e),i=1;for(var n in this.soundFiles)s.options[i]=new Option(n,n),n===t&&(s.options[i].selected=!0),i++},setStatus:function(e){"waiting"===e&&"retrying"===this.requestStatus||(this.requestStatus=e),this.dom.statusIcon&&(this.dom.statusIcon.className=this.requestStatus)},forceNewRequest:function(){ajaxChat.updateChat(null),ajaxChat.setStatus("retrying")},getHttpRequest:function(e){if(!this.httpRequest[e])if(window.XMLHttpRequest)this.httpRequest[e]=new XMLHttpRequest,this.httpRequest[e].overrideMimeType&&this.httpRequest[e].overrideMimeType("text/xml");else if(window.ActiveXObject)try{this.httpRequest[e]=new ActiveXObject("Msxml2.XMLHTTP")}catch(t){try{this.httpRequest[e]=new ActiveXObject("Microsoft.XMLHTTP")}catch(e){}}return this.httpRequest[e]},makeRequest:function(e,t,s){var i,n=this;n.setStatus("waiting");try{s?(!arguments.callee.identifier||arguments.callee.identifier>50?arguments.callee.identifier=1:arguments.callee.identifier++,i=arguments.callee.identifier):i=0,n.retryTimer=setTimeout(ajaxChat.forceNewRequest,ajaxChat.retryTimerDelay),n.getHttpRequest(i).open(t,e,!0),n.getHttpRequest(i).onreadystatechange=function(){try{ajaxChat.handleResponse(i)}catch(e){try{clearTimeout(ajaxChat.timer)}catch(e){n.debugMessage("makeRequest::clearTimeout",e)}try{s&&(ajaxChat.addChatBotMessageToChatList("/error ConnectionTimeout"),ajaxChat.setStatus("retrying"),ajaxChat.updateChatlistView())}catch(e){n.debugMessage("makeRequest::logRetry",e)}try{ajaxChat.timer=setTimeout(function(){ajaxChat.updateChat(null)},ajaxChat.timerRate)}catch(e){n.debugMessage("makeRequest::setTimeout",e)}}},"POST"===t&&n.getHttpRequest(i).setRequestHeader("Content-Type","application/x-www-form-urlencoded"),n.getHttpRequest(i).send(s)}catch(e){clearTimeout(this.timer),s&&(n.addChatBotMessageToChatList("/error ConnectionTimeout"),ajaxChat.setStatus("retrying"),n.updateChatlistView()),n.timer=setTimeout(function(){ajaxChat.updateChat(null)},n.timerRate)}},handleResponse:function(e){var t;if(4===this.getHttpRequest(e).readyState){if(200!==this.getHttpRequest(e).status)return 0===this.getHttpRequest(e).status?(this.setStatus("waiting"),this.updateChatlistView(),!1):(this.addChatBotMessageToChatList("/error ConnectionStatus "+this.getHttpRequest(e).status),this.setStatus("retrying"),this.updateChatlistView(),!1);clearTimeout(ajaxChat.retryTimer),t=this.getHttpRequest(e).responseXML,ajaxChat.setStatus("ok")}return!!t&&(this.handleXML(t),!0)},handleXML:function(e){this.handleInfoMessages(e.getElementsByTagName("info")),this.handleOnlineUsers(e.getElementsByTagName("user")),this.handleChatMessages(e.getElementsByTagName("message")),this.channelSwitch=null,this.setChatUpdateTimer()},setChatUpdateTimer:function(){var e;(clearTimeout(this.timer),this.chatStarted)&&(this.socketIsConnected?e=this.socketTimerRate:(e=this.timerRate,this.socketServerEnabled&&!this.socketReconnectTimer&&(this.socketReconnectTimer=setTimeout(ajaxChat.socketConnect,6e4))),this.timer=setTimeout(function(){ajaxChat.updateChat(null)},e))},handleInfoMessages:function(e){for(var t,s,i=0;i<e.length;i++)t=e[i].getAttribute("type"),s=e[i].firstChild?e[i].firstChild.nodeValue:"",this.handleInfoMessage(t,s)},handleInfoMessage:function(e,t){if(!0!==this.handleCustomInfoMessage(e,t))switch(e){case"channelSwitch":this.clearChatList(),this.clearOnlineUsersList(),this.setSelectedChannel(t),this.channelName=t,this.channelSwitch=!0;break;case"channelName":this.setSelectedChannel(t),this.channelName=t;break;case"channelID":this.channelID=t;break;case"userID":this.userID=t;break;case"userName":this.userName=t,this.encodedUserName=this.scriptLinkEncode(this.userName),this.userNodeString=null;break;case"userRole":this.userRole=t;break;case"logout":return void this.handleLogout(t);case"socketRegistrationID":this.socketRegistrationID=t,this.socketRegister();default:return}},handleOnlineUsers:function(e){if(e.length){var t,s,i,n,a,r=[];for(a=0;a<e.length;a++)s=e[a].getAttribute("userID"),i=e[a].firstChild?e[a].firstChild.nodeValue:"",n=e[a].getAttribute("userRole"),r.push(s),-1===(t=this.arraySearch(s,this.usersList))?this.addUserToOnlineList(s,i,n):this.userNamesList[t]!==i&&(this.removeUserFromOnlineList(s,t),this.addUserToOnlineList(s,i,n));for(a=0;a<this.usersList.length;a++)this.inArray(r,this.usersList[a])||this.removeUserFromOnlineList(this.usersList[a],a);this.setOnlineListRowClasses()}},handleChatMessages:function(e){var t,s,i,n,a;if(e.length){for(a=0;a<e.length;a++)this.DOMbuffering=!0,s=(t=e[a].getElementsByTagName("username")[0]).firstChild?t.firstChild.nodeValue:"",n=(i=e[a].getElementsByTagName("text")[0]).firstChild?i.firstChild.nodeValue:"",a===e.length-1&&(this.DOMbuffering=!1),this.addMessageToChatList(new Date(e[a].getAttribute("dateTime")),e[a].getAttribute("userID"),s,e[a].getAttribute("userRole"),e[a].getAttribute("id"),n,e[a].getAttribute("channelID"),e[a].getAttribute("ip"));this.DOMbuffering=!1,this.updateChatlistView(),this.lastID=e[e.length-1].getAttribute("id")}},setSelectedChannel:function(e){var t,s,i,n=!1;if(this.dom.channelSelection){for(e=this.decodeSpecialChars(e),t=0;t<this.dom.channelSelection.options.length;t++)if(this.dom.channelSelection.options[t].value===e){this.dom.channelSelection.options[t].selected=!0,n=!0;break}n||(s=document.createElement("option"),i=document.createTextNode(e),s.appendChild(i),s.setAttribute("value",e),s.setAttribute("selected","selected"),this.dom.channelSelection.appendChild(s))}},removeUserFromOnlineList:function(e,t){this.usersList.splice(t,1),this.userNamesList.splice(t,1),this.dom.onlineList&&this.dom.onlineList.removeChild(this.getUserNode(e))},addUserToOnlineList:function(e,t,s){this.usersList.push(e),this.userNamesList.push(t),this.dom.onlineList&&this.updateDOM("onlineList",this.getUserNodeString(e,t,s),this.userID===e)},getUserNodeString:function(e,t,s){var i,n;return this.userNodeString&&e===this.userID?this.userNodeString:(i=this.scriptLinkEncode(t),n='<div id="'+this.getUserDocumentID(e)+'"><a href="javascript:ajaxChat.toggleUserMenu(\''+this.getUserMenuDocumentID(e)+"', '"+i+"', "+e+');" class="'+this.getRoleClass(s)+'" title="'+this.lang.toggleUserMenu.replace(/%s/,t)+'">'+t+'</a><ul class="userMenu" id="'+this.getUserMenuDocumentID(e)+'" style="display:none;"></ul></div>',e===this.userID&&(this.userNodeString=n),n)},toggleUserMenu:function(e,t,s){var i=!1;e.indexOf("ium")>=0&&(i=!0),document.getElementById(e).firstChild||this.updateDOM(e,this.getUserNodeStringItems(this.encodeText(this.addSlashes(this.getScriptLinkValue(t))),s,i),!1,!0),this.showHide(e),this.dom.chatList.scrollTop=this.dom.chatList.scrollHeight},getUserNodeStringItems:function(e,t,s){var i;return e!==this.encodedUserName?(i="<li><a href=\"javascript:ajaxChat.insertMessageWrapper('/msg "+e+" ');\">"+this.lang.userMenuSendPrivateMessage+"</a></li><li><a href=\"javascript:ajaxChat.insertMessageWrapper('/describe "+e+" ');\">"+this.lang.userMenuDescribe+"</a></li><li><a href=\"javascript:ajaxChat.sendMessageWrapper('/query "+e+"');\">"+this.lang.userMenuOpenPrivateChannel+"</a></li><li><a href=\"javascript:ajaxChat.sendMessageWrapper('/query');\">"+this.lang.userMenuClosePrivateChannel+"</a></li><li><a href=\"javascript:ajaxChat.sendMessageWrapper('/ignore "+e+"');\">"+this.lang.userMenuIgnore+"</a></li>",s&&(i+="<li><a href=\"javascript:ajaxChat.sendMessageWrapper('/invite "+e+"');\">"+this.lang.userMenuInvite+"</a></li><li><a href=\"javascript:ajaxChat.sendMessageWrapper('/uninvite "+e+"');\">"+this.lang.userMenuUninvite+"</a></li><li><a href=\"javascript:ajaxChat.sendMessageWrapper('/whereis "+e+"');\">"+this.lang.userMenuWhereis+"</a></li>"),"2"!==this.userRole&&"3"!==this.userRole||(i+="<li><a href=\"javascript:ajaxChat.insertMessageWrapper('/kick "+e+" ');\">"+this.lang.userMenuKick+"</a></li><li><a href=\"javascript:ajaxChat.sendMessageWrapper('/whois "+e+"');\">"+this.lang.userMenuWhois+"</a></li>")):(i="<li><a href=\"javascript:ajaxChat.sendMessageWrapper('/who');\">"+this.lang.userMenuWho+"</a></li>","1"!==this.userRole&&"2"!==this.userRole&&"3"!==this.userRole||(i+="<li><a href=\"javascript:ajaxChat.sendMessageWrapper('/join');\">"+this.lang.userMenuEnterPrivateRoom+"</a></li>","2"!==this.userRole&&"3"!==this.userRole||(i+="<li><a href=\"javascript:ajaxChat.sendMessageWrapper('/bans');\">"+this.lang.userMenuBans+"</a></li>"))),i+=this.getCustomUserMenuItems(e,t)},setOnlineListRowClasses:function(){if(this.dom.onlineList)for(var e=this.dom.onlineList.firstChild,t=!1;e;)e.className=t?"rowEven":"rowOdd",e=e.nextSibling,t=!t},clearChatList:function(){for(;this.dom.chatList.hasChildNodes();)this.dom.chatList.removeChild(this.dom.chatList.firstChild)},clearOnlineUsersList:function(){if(this.usersList=[],this.userNamesList=[],this.dom.onlineList)for(;this.dom.onlineList.hasChildNodes();)this.dom.onlineList.removeChild(this.dom.onlineList.firstChild)},getEncodedChatBotName:function(){return void 0===arguments.callee.encodedChatBotName&&(arguments.callee.encodedChatBotName=this.encodeSpecialChars(this.chatBotName)),arguments.callee.encodedChatBotName},addChatBotMessageToChatList:function(e){this.addMessageToChatList(new Date,this.chatBotID,this.getEncodedChatBotName(),4,null,e,null)},addMessageToChatList:function(e,t,s,i,n,a,r,o){this.getMessageNode(n)||this.onNewMessage(e,t,s,i,n,a,r,o)&&(this.DOMbufferRowClass="rowEven"===this.DOMbufferRowClass?"rowOdd":"rowEven",this.DOMbuffer=this.DOMbuffer+this.getChatListMessageString(e,t,s,i,n,a,r,o),this.DOMbuffering||(this.updateDOM("chatList",this.DOMbuffer),this.DOMbuffer=""))},getChatListMessageString:function(e,t,s,i,n,a,r,o){var l=this.DOMbufferRowClass,h=this.getRoleClass(i),c=": ";0!==a.indexOf("/action")&&0!==a.indexOf("/me")&&0!==a.indexOf("/privaction")||(h+=" action",c=" "),0!==a.indexOf("/privmsg")&&0!==a.indexOf("/privmsgto")&&0!==a.indexOf("/privaction")||(l+=" private");var u=this.settings.dateFormat?'<span class="dateTime">'+this.formatDate(this.settings.dateFormat,e)+"</span> ":"";return'<div id="'+this.getMessageDocumentID(n)+'" class="'+l+'">'+this.getDeletionLink(n,t,i,r)+u+'<span class="'+h+'"'+this.getChatListUserNameTitle(t,s,i,o)+' dir="'+this.baseDirection+'" onclick="ajaxChat.insertText(this.firstChild.nodeValue);">'+s+"</span>"+c+this.replaceText(a)+"</div>"},getChatListUserNameTitle:function(e,t,s,i){return null!==i?' title="IP: '+i+'"':""},getMessageDocumentID:function(e){return null===e?"ajaxChat_lm_"+this.localID++:"ajaxChat_m_"+e},getMessageNode:function(e){return null===e?null:document.getElementById(this.getMessageDocumentID(e))},getUserDocumentID:function(e){return"ajaxChat_u_"+e},getUserNode:function(e){return document.getElementById(this.getUserDocumentID(e))},getUserMenuDocumentID:function(e){return"ajaxChat_um_"+e},getInlineUserMenuDocumentID:function(e,t){return"ajaxChat_ium_"+e+"_"+t},getDeletionLink:function(e,t,s,i){return null!==e&&this.isAllowedToDeleteMessage(e,t,s,i)?(arguments.callee.deleteMessage||(arguments.callee.deleteMessage=this.encodeSpecialChars(this.lang.deleteMessage)),'<a class="delete" title="'+arguments.callee.deleteMessage+'" href="javascript:ajaxChat.deleteMessage('+e+');"> </a>'):""},isAllowedToDeleteMessage:function(e,t,s,i){return!((("1"!==this.userRole||!this.allowUserMessageDelete||t!==this.userID&&parseInt(i)!==parseInt(this.userID)+this.privateMessageDiff&&parseInt(i)!==parseInt(this.userID)+this.privateChannelDiff)&&("5"!==this.userRole||!this.allowUserMessageDelete||t!==this.userID&&parseInt(i)!==parseInt(this.userID)+this.privateMessageDiff&&parseInt(i)!==parseInt(this.userID)+this.privateChannelDiff)&&"2"!==this.userRole||"3"===s||"4"===s)&&"3"!==this.userRole)},onNewMessage:function(e,t,s,i,n,a,r,o){return!!this.customOnNewMessage(e,t,s,i,n,a,r,o)&&(!this.ignoreMessage(e,t,s,i,n,a,r,o)&&(!this.parseDeleteMessageCommand(a)&&(this.blinkOnNewMessage(e,t,s,i,n,a,r,o),this.playSoundOnNewMessage(e,t,s,i,n,a,r,o),!0)))},parseDeleteMessageCommand:function(e){if(0===e.indexOf("/delete")){var t=e.substr(8),s=this.getMessageNode(t);if(s){var i=s.nextSibling;try{this.dom.chatList.removeChild(s),i&&this.updateChatListRowClasses(i)}catch(e){}}return!0}return!1},blinkOnNewMessage:function(e,t,s,i,n,a,r,o){this.settings.blink&&this.lastID&&!this.channelSwitch&&t!==this.userID&&(clearInterval(this.blinkInterval),this.blinkInterval=setInterval("ajaxChat.blinkUpdate('"+this.addSlashes(this.decodeSpecialChars(s))+"')",this.settings.blinkInterval))},blinkUpdate:function(e){this.originalDocumentTitle||(this.originalDocumentTitle=document.title),arguments.callee.blink?arguments.callee.blink>this.settings.blinkIntervalNumber?(clearInterval(this.blinkInterval),document.title=this.originalDocumentTitle,arguments.callee.blink=0):(arguments.callee.blink%2!=0?document.title="[@ ] "+e+" - "+this.originalDocumentTitle:document.title="[ @] "+e+" - "+this.originalDocumentTitle,arguments.callee.blink++):(document.title="[@ ] "+e+" - "+this.originalDocumentTitle,arguments.callee.blink=1)},updateChatlistView:function(){if(this.dom.chatList.childNodes&&this.settings.maxMessages)for(;this.dom.chatList.childNodes.length>this.settings.maxMessages;)this.dom.chatList.removeChild(this.dom.chatList.firstChild);if(this.settings.autoScroll){var e=this;setTimeout(function(){e.scrollChatList()},50)}},scrollChatList:function(){this.dom.chatList.scrollTop=this.dom.chatList.scrollHeight},encodeText:function(e){return encodeURIComponent(e)},decodeText:function(e){return decodeURIComponent(e)},utf8Encode:function(e){for(var t="",s=0;s<e.length;s++){var i=e.charCodeAt(s);i<128?t+=String.fromCharCode(i):i>127&&i<2048?(t+=String.fromCharCode(i>>6|192),t+=String.fromCharCode(63&i|128)):(t+=String.fromCharCode(i>>12|224),t+=String.fromCharCode(i>>6&63|128),t+=String.fromCharCode(63&i|128))}return t},utf8Decode:function(e){for(var t,s,i,n="",a=0;a<e.length;)(t=e.charCodeAt(a))<128?(n+=String.fromCharCode(t),a++):t>191&&t<224?(s=e.charCodeAt(a+1),n+=String.fromCharCode((31&t)<<6|63&s),a+=2):(s=e.charCodeAt(a+1),i=e.charCodeAt(a+2),n+=String.fromCharCode((15&t)<<12|(63&s)<<6|63&i),a+=3);return n},encodeSpecialChars:function(e){return e.replace(/[&<>'"]/g,this.encodeSpecialCharsCallback)},encodeSpecialCharsCallback:function(e){switch(e){case"&":return"&amp;";case"<":return"&lt;";case">":return"&gt;";case"'":return"&#39;";case'"':return"&quot;";default:return e}},decodeSpecialChars:function(e){var t=new RegExp("(&amp;)|(&lt;)|(&gt;)|(&#39;)|(&quot;)","g");return e.replace(t,this.decodeSpecialCharsCallback)},decodeSpecialCharsCallback:function(e){switch(e){case"&amp;":return"&";case"&lt;":return"<";case"&gt;":return">";case"&#39;":return"'";case"&quot;":return'"';default:return e}},inArray:function(e,t){for(var s=e.length;s--;)if(e[s]===t)return!0;return!1},arraySearch:function(e,t){if(Array.prototype.indexOf)return t.indexOf(e);for(var s=t.length;s--;)if(t[s]===e)return s;return-1},stripTags:function(e){return arguments.callee.regExp||(arguments.callee.regExp=new RegExp("<\\/?[^>]+?>","g")),e.replace(arguments.callee.regExp,"")},stripBBCodeTags:function(e){return arguments.callee.regExp||(arguments.callee.regExp=new RegExp("\\[\\/?[^\\]]+?\\]","g")),e.replace(arguments.callee.regExp,"")},escapeRegExp:function(e){if(!arguments.callee.regExp){var t=new Array("^","$","*","+","?",".","|","/","(",")","[","]","{","}","\\");arguments.callee.regExp=new RegExp("(\\"+t.join("|\\")+")","g")}return e.replace(arguments.callee.regExp,"\\$1")},addSlashes:function(e){return e.replace(/\\/g,"\\\\").replace(/\'/g,"\\'")},removeSlashes:function(e){return e.replace(/\\\\/g,"\\").replace(/\\\'/g,"'")},formatDate:function(e,t){return t=null===t?new t:t,e.replace(/%Y/g,t.getFullYear()).replace(/%m/g,this.addLeadingZero(t.getMonth()+1)).replace(/%d/g,this.addLeadingZero(t.getDate())).replace(/%H/g,this.addLeadingZero(t.getHours())).replace(/%i/g,this.addLeadingZero(t.getMinutes())).replace(/%s/g,this.addLeadingZero(t.getSeconds()))},addLeadingZero:function(e){return(e=e.toString()).length<2&&(e="0"+e),e},getUserIDFromUserName:function(e){var t=this.arraySearch(e,this.userNamesList);return-1!==t?this.usersList[t]:null},getUserNameFromUserID:function(e){var t=this.arraySearch(e,this.usersList);return-1!==t?this.userNamesList[t]:null},getRoleClass:function(e){switch(parseInt(e)){case 0:return"guest";case 1:return"user";case 2:return"moderator";case 3:return"admin";case 4:return"chatBot";case 5:return"customUser";default:return"default"}},handleInputFieldKeyDown:function(e){var t,s,i;if(13===e.keyCode&&!e.shiftKey){this.sendMessage();try{e.preventDefault()}catch(t){e.returnValue=!1}return!1}if(9===e.keyCode&&!e.shiftKey){if((t=this.dom.inputField.value)&&(s=t.match(/\w+/g).slice(-1)[0]).length>2)for(i=0;i<this.userNamesList.length;i++)if(0===this.userNamesList[i].replace("(","").toLowerCase().indexOf(s.toLowerCase())){this.dom.inputField.value=t.replace(new RegExp(s+"$"),this.userNamesList[i]);break}try{e.preventDefault()}catch(t){e.returnValue=!1}return!1}return!0},handleInputFieldKeyUp:function(e){this.updateMessageLengthCounter()},updateMessageLengthCounter:function(){this.dom.messageLengthCounter&&this.updateDOM("messageLengthCounter",this.dom.inputField.value.length+"/"+this.messageTextMaxLength,!1,!0)},sendMessage:function(e){if(e=e||this.dom.inputField.value){if(e=this.parseInputMessage(e)){clearTimeout(this.timer);var t="lastID="+this.lastID+"&text="+this.encodeText(e);this.makeRequest(this.ajaxURL,"POST",t)}this.dom.inputField.value="",this.dom.inputField.focus(),this.updateMessageLengthCounter()}},parseInputMessage:function(e){var t;if("/"===e.charAt(0)){switch((t=e.split(" "))[0]){case"/ignore":e=this.parseIgnoreInputCommand(e,t);break;case"/clear":return this.clearChatList(),!1;default:e=this.parseCustomInputCommand(e,t)}e&&this.settings.persistFontColor&&this.settings.fontColor&&(e=this.assignFontColorToCommandMessage(e,t))}else(e=this.parseCustomInputMessage(e))&&this.settings.persistFontColor&&this.settings.fontColor&&(e=this.assignFontColorToMessage(e));return e},assignFontColorToMessage:function(e){return"[color="+this.settings.fontColor+"]"+e+"[/color]"},assignFontColorToCommandMessage:function(e,t){switch(t[0]){case"/msg":case"/describe":if(t.length>2)return t[0]+" "+t[1]+" [color="+this.settings.fontColor+"]"+t.slice(2).join(" ")+"[/color]";break;case"/me":case"/action":if(t.length>1)return t[0]+" [color="+this.settings.fontColor+"]"+t.slice(1).join(" ")+"[/color]"}return e},parseIgnoreInputCommand:function(e,t){var s,i,n=this.getIgnoredUserNames();if(t.length>1){if((s=this.encodeSpecialChars(t[1]))===this.userName||s===this.getEncodedChatBotName())return this.parseIgnoreInputCommand(null,new Array("/ignore"));if(n.length>0)for(i=n.length;i--;)if(n[i]===s)return n.splice(i,1),this.addChatBotMessageToChatList("/ignoreRemoved "+s),this.setIgnoredUserNames(n),this.updateChatlistView(),null;n.push(s),this.addChatBotMessageToChatList("/ignoreAdded "+s),this.setIgnoredUserNames(n)}else 0===n.length?this.addChatBotMessageToChatList("/ignoreListEmpty -"):this.addChatBotMessageToChatList("/ignoreList "+n.join(" "));return this.updateChatlistView(),null},getIgnoredUserNames:function(){var e;return this.ignoredUserNames||(e=this.getSetting("ignoredUserNames"),this.ignoredUserNames=e?e.split(" "):[]),this.ignoredUserNames},setIgnoredUserNames:function(e){this.ignoredUserNames=e,this.setSetting("ignoredUserNames",e.join(" "))},ignoreMessage:function(e,t,s,i,n,a,r,o){var l;if(t===this.chatBotID&&"/"===a.charAt(0)&&(l=a.split(" ")).length>1)switch(l[0]){case"/invite":case"/uninvite":case"/roll":s=l[1]}return!!this.inArray(this.getIgnoredUserNames(),s)},deleteMessage:function(e){var t,s,i=this.getMessageNode(e);if(i)if(t=i.className,this.addClass(i,"deleteSelected"),confirm(this.lang.deleteMessageConfirm)){s=i.nextSibling;try{this.dom.chatList.removeChild(i),s&&this.updateChatListRowClasses(s),this.updateChat("&delete="+e)}catch(e){i.className=t}}else i.className=t},updateChatListRowClasses:function(e){var t,s;if(e||(e=this.dom.chatList.firstChild),e)for(s=!(!(t=e.previousSibling)||"rowOdd"!==t.className);e;)e.className=s?"rowEven":"rowOdd",e=e.nextSibling,s=!s},addEvent:function(e,t,s){e&&(e.addEventListener?e.addEventListener(t,s,!1):e.attachEvent?e.attachEvent("on"+t,s):e["on"+t]=s)},addClass:function(e,t){this.hasClass(e,t)||(e.className+=" "+t)},removeClass:function(e,t){e.className=e.className.replace(new RegExp("(?:^|\\s)"+t+"(?!\\S)","g"),"")},hasClass:function(e,t){return e.className.match(new RegExp("\\b"+t+"\\b"))},scriptLinkEncode:function(e){return this.encodeText(this.addSlashes(this.decodeSpecialChars(e)))},scriptLinkDecode:function(e){return this.encodeSpecialChars(this.removeSlashes(this.decodeText(e)))},getScriptLinkValue:function(e){if(void 0!==arguments.callee.utf8Decode)return arguments.callee.utf8Decode?this.utf8Decode(e):e;switch(navigator.appName){case"Microsoft Internet Explorer":case"Opera":return arguments.callee.utf8Decode=!0,this.utf8Decode(e);default:return arguments.callee.utf8Decode=!1,e}},sendMessageWrapper:function(e){this.sendMessage(this.getScriptLinkValue(e))},insertMessageWrapper:function(e){this.insertText(this.getScriptLinkValue(e),!0)},switchChannel:function(e){if(!this.chatStarted)return this.clearChatList(),this.channelSwitch=!0,this.loginChannelID=null,this.loginChannelName=e,void this.requestTeaserContent();clearTimeout(this.timer);var t="lastID="+this.lastID+"&channelName="+this.encodeText(e);this.makeRequest(this.ajaxURL,"POST",t),this.dom.inputField&&this.settings.autoFocus&&this.dom.inputField.focus()},logout:function(){clearTimeout(this.timer);this.makeRequest(this.ajaxURL,"POST","logout=true")},handleLogout:function(e){window.location.href=e},toggleSetting:function(e,t){this.setSetting(e,!this.getSetting(e)),t&&this.updateButton(e,t)},updateButton:function(e,t){var s=document.getElementById(t);s&&(s.className=this.getSetting(e)?"button":"button off")},showHide:function(e,t,s){var i=document.getElementById(e);i&&(t?i.style.display=t:"none"===i.style.display?i.style.display=s?"inline":"block":i.style.display="none")},setPersistFontColor:function(e){this.settings.persistFontColor=e,this.settings.persistFontColor||(this.settings.fontColor=null,this.dom.inputField&&(this.dom.inputField.style.color=""))},setFontColor:function(e){this.settings.persistFontColor?(this.settings.fontColor=e,this.dom.inputField&&(this.dom.inputField.style.color=e),this.dom.colorCodesContainer&&(this.dom.colorCodesContainer.style.display="none",this.dom.inputField&&this.dom.inputField.focus())):this.insert("[color="+e+"]","[/color]")},insertText:function(e,t){t&&(this.dom.inputField.value=""),this.insert(e,"")},insertBBCode:function(e){switch(e){case"url":var t=prompt(this.lang.urlDialog,"http://");t?this.insert("[url="+t+"]","[/url]"):this.dom.inputField.focus();break;default:this.insert("["+e+"]","[/"+e+"]")}},insert:function(e,t){if(this.dom.inputField.focus(),void 0!==document.selection){var s=document.selection.createRange(),i=s.text;s.text=e+i+t,s=document.selection.createRange(),0===i.length?s.move("character",-t.length):s.moveStart("character",e.length+i.length+t.length),s.select()}else if(void 0!==this.dom.inputField.selectionStart){var n=this.dom.inputField.selectionStart,a=this.dom.inputField.selectionEnd;i=this.dom.inputField.value.substring(n,a);this.dom.inputField.value=this.dom.inputField.value.substr(0,n)+e+i+t+this.dom.inputField.value.substr(a),r=0===i.length?n+e.length:n+e.length+i.length+t.length,this.dom.inputField.selectionStart=r,this.dom.inputField.selectionEnd=r}else{var r=this.dom.inputField.value.length;this.dom.inputField.value=this.dom.inputField.value.substr(0,r)+e+t+this.dom.inputField.value.substr(r)}},replaceText:function(e){try{"/"===(e=this.replaceLineBreaks(e)).charAt(0)?e=this.replaceCommands(e):(e=this.replaceBBCode(e),e=this.replaceHyperLinks(e),e=this.replaceEmoticons(e)),e=this.breakLongWords(e),e=this.replaceCustomText(e)}catch(e){this.debugMessage("replaceText",e)}return e},replaceCommands:function(e){try{if("/"!==e.charAt(0))return e;var t=e.split(" ");switch(t[0]){case"/login":return this.replaceCommandLogin(t);case"/logout":return this.replaceCommandLogout(t);case"/channelEnter":return this.replaceCommandChannelEnter(t);case"/channelLeave":return this.replaceCommandChannelLeave(t);case"/privmsg":return this.replaceCommandPrivMsg(t);case"/privmsgto":return this.replaceCommandPrivMsgTo(t);case"/privaction":return this.replaceCommandPrivAction(t);case"/privactionto":return this.replaceCommandPrivActionTo(t);case"/me":case"/action":return this.replaceCommandAction(t);case"/invite":return this.replaceCommandInvite(t);case"/inviteto":return this.replaceCommandInviteTo(t);case"/uninvite":return this.replaceCommandUninvite(t);case"/uninviteto":return this.replaceCommandUninviteTo(t);case"/queryOpen":return this.replaceCommandQueryOpen(t);case"/queryClose":return this.replaceCommandQueryClose(t);case"/ignoreAdded":return this.replaceCommandIgnoreAdded(t);case"/ignoreRemoved":return this.replaceCommandIgnoreRemoved(t);case"/ignoreList":return this.replaceCommandIgnoreList(t);case"/ignoreListEmpty":return this.replaceCommandIgnoreListEmpty(t);case"/kick":return this.replaceCommandKick(t);case"/who":return this.replaceCommandWho(t);case"/whoChannel":return this.replaceCommandWhoChannel(t);case"/whoEmpty":return this.replaceCommandWhoEmpty(t);case"/list":return this.replaceCommandList(t);case"/bans":return this.replaceCommandBans(t);case"/bansEmpty":return this.replaceCommandBansEmpty(t);case"/unban":return this.replaceCommandUnban(t);case"/whois":return this.replaceCommandWhois(t);case"/whereis":return this.replaceCommandWhereis(t);case"/roll":return this.replaceCommandRoll(t);case"/nick":return this.replaceCommandNick(t);case"/error":return this.replaceCommandError(t);default:return this.replaceCustomCommands(e,t)}}catch(e){this.debugMessage("replaceCommands",e)}return e},replaceCommandLogin:function(e){return'<span class="chatBotMessage">'+this.lang.login.replace(/%s/,e[1])+"</span>"},replaceCommandLogout:function(e){var t="";return 3===e.length&&(t=e[2]),'<span class="chatBotMessage">'+this.lang["logout"+t].replace(/%s/,e[1])+"</span>"},replaceCommandChannelEnter:function(e){return'<span class="chatBotMessage">'+this.lang.channelEnter.replace(/%s/,e[1])+"</span>"},replaceCommandChannelLeave:function(e){return'<span class="chatBotMessage">'+this.lang.channelLeave.replace(/%s/,e[1])+"</span>"},replaceCommandPrivMsg:function(e){var t=e.slice(1).join(" ");return t=this.replaceBBCode(t),t=this.replaceHyperLinks(t),t=this.replaceEmoticons(t),'<span class="privmsg">'+this.lang.privmsg+"</span> "+t},replaceCommandPrivMsgTo:function(e){var t=e.slice(2).join(" ");return t=this.replaceBBCode(t),t=this.replaceHyperLinks(t),t=this.replaceEmoticons(t),'<span class="privmsg">'+this.lang.privmsgto.replace(/%s/,e[1])+"</span> "+t},replaceCommandPrivAction:function(e){var t=e.slice(1).join(" ");return t=this.replaceBBCode(t),t=this.replaceHyperLinks(t),'<span class="action">'+(t=this.replaceEmoticons(t))+'</span> <span class="privmsg">'+this.lang.privmsg+"</span> "},replaceCommandPrivActionTo:function(e){var t=e.slice(2).join(" ");return t=this.replaceBBCode(t),t=this.replaceHyperLinks(t),'<span class="action">'+(t=this.replaceEmoticons(t))+'</span> <span class="privmsg">'+this.lang.privmsgto.replace(/%s/,e[1])+"</span> "},replaceCommandAction:function(e){var t=e.slice(1).join(" ");return t=this.replaceBBCode(t),t=this.replaceHyperLinks(t),'<span class="action">'+(t=this.replaceEmoticons(t))+"</span>"},replaceCommandInvite:function(e){return'<span class="chatBotMessage">'+this.lang.invite.replace(/%s/,e[1]).replace(/%s/,"<a href=\"javascript:ajaxChat.sendMessageWrapper('/join "+this.scriptLinkEncode(e[2])+'\');" title="'+this.lang.joinChannel.replace(/%s/,e[2])+'">'+e[2]+"</a>")+"</span>"},replaceCommandInviteTo:function(e){return'<span class="chatBotMessage">'+this.lang.inviteto.replace(/%s/,e[1]).replace(/%s/,e[2])+"</span>"},replaceCommandUninvite:function(e){return'<span class="chatBotMessage">'+this.lang.uninvite.replace(/%s/,e[1]).replace(/%s/,e[2])+"</span>"},replaceCommandUninviteTo:function(e){return'<span class="chatBotMessage">'+this.lang.uninviteto.replace(/%s/,e[1]).replace(/%s/,e[2])+"</span>"},replaceCommandQueryOpen:function(e){return'<span class="chatBotMessage">'+this.lang.queryOpen.replace(/%s/,e[1])+"</span>"},replaceCommandQueryClose:function(e){return'<span class="chatBotMessage">'+this.lang.queryClose.replace(/%s/,e[1])+"</span>"},replaceCommandIgnoreAdded:function(e){return'<span class="chatBotMessage">'+this.lang.ignoreAdded.replace(/%s/,e[1])+"</span>"},replaceCommandIgnoreRemoved:function(e){return'<span class="chatBotMessage">'+this.lang.ignoreRemoved.replace(/%s/,e[1])+"</span>"},replaceCommandIgnoreList:function(e){return'<span class="chatBotMessage">'+this.lang.ignoreList+" "+this.getInlineUserMenu(e.slice(1))+"</span>"},replaceCommandIgnoreListEmpty:function(e){return'<span class="chatBotMessage">'+this.lang.ignoreListEmpty+"</span>"},replaceCommandKick:function(e){return'<span class="chatBotMessage">'+this.lang.logoutKicked.replace(/%s/,e[1])+"</span>"},replaceCommandWho:function(e){return'<span class="chatBotMessage">'+this.lang.who+" "+this.getInlineUserMenu(e.slice(1))+"</span>"},replaceCommandWhoChannel:function(e){return'<span class="chatBotMessage">'+this.lang.whoChannel.replace(/%s/,e[1])+" "+this.getInlineUserMenu(e.slice(2))+"</span>"},replaceCommandWhoEmpty:function(e){return'<span class="chatBotMessage">'+this.lang.whoEmpty+"</span>"},replaceCommandList:function(e){for(var t,s=e.slice(1),i=[],n=0;n<s.length;n++)t=s[n]===this.channelName?"<b>"+s[n]+"</b>":s[n],i.push("<a href=\"javascript:ajaxChat.sendMessageWrapper('/join "+this.scriptLinkEncode(s[n])+'\');" title="'+this.lang.joinChannel.replace(/%s/,s[n])+'">'+t+"</a>");return'<span class="chatBotMessage">'+this.lang.list+" "+i.join(", ")+"</span>"},replaceCommandBans:function(e){for(var t=e.slice(1),s=[],i=0;i<t.length;i++)s.push("<a href=\"javascript:ajaxChat.sendMessageWrapper('/unban "+this.scriptLinkEncode(t[i])+'\');" title="'+this.lang.unbanUser.replace(/%s/,t[i])+'">'+t[i]+"</a>");return'<span class="chatBotMessage">'+this.lang.bans+" "+s.join(", ")+"</span>"},replaceCommandBansEmpty:function(e){return'<span class="chatBotMessage">'+this.lang.bansEmpty+"</span>"},replaceCommandUnban:function(e){return'<span class="chatBotMessage">'+this.lang.unban.replace(/%s/,e[1])+"</span>"},replaceCommandWhois:function(e){return'<span class="chatBotMessage">'+this.lang.whois.replace(/%s/,e[1])+" "+e[2]+"</span>"},replaceCommandWhereis:function(e){return'<span class="chatBotMessage">'+this.lang.whereis.replace(/%s/,e[1]).replace(/%s/,"<a href=\"javascript:ajaxChat.sendMessageWrapper('/join "+this.scriptLinkEncode(e[2])+'\');" title="'+this.lang.joinChannel.replace(/%s/,e[2])+'">'+e[2]+"</a>")+"</span>"},replaceCommandRoll:function(e){var t=this.lang.roll.replace(/%s/,e[1]);return'<span class="chatBotMessage">'+(t=(t=t.replace(/%s/,e[2])).replace(/%s/,e[3]))+"</span>"},replaceCommandNick:function(e){return'<span class="chatBotMessage">'+this.lang.nick.replace(/%s/,e[1]).replace(/%s/,e[2])+"</span>"},replaceCommandError:function(e){var t=this.lang["error"+e[1]];return t?e.length>2&&(t=t.replace(/%s/,e.slice(2).join(" "))):t="Error: Unknown.",'<span class="chatBotErrorMessage">'+t+"</span>"},getInlineUserMenu:function(e){for(var t="",s=0;s<e.length;s++)s>0&&(t+=", "),t+="<a href=\"javascript:ajaxChat.toggleUserMenu('"+this.getInlineUserMenuDocumentID(this.userMenuCounter,s)+"', '"+this.scriptLinkEncode(e[s])+'\', null);" title="'+this.lang.toggleUserMenu.replace(/%s/,e[s])+'" dir="'+this.baseDirection+'">'+(e[s]===this.userName?"<b>"+e[s]+"</b>":e[s])+'</a><ul class="inlineUserMenu" id="'+this.getInlineUserMenuDocumentID(this.userMenuCounter,s)+'" style="display:none;"></ul>';return this.userMenuCounter++,t},containsUnclosedTags:function(e){var t,s;return t=e.match(/<[^>\/]+?>/gm),s=e.match(/<\/[^>]+?>/gm),!!(!t&&s||t&&!s||t&&s&&t.length!==s.length)},breakLongWords:function(e){var t,s,i,n,a,r;if(!this.settings.wordWrap)return e;for(t="",s=0,r=0;r<e.length;r++)"<"===(i=e.charAt(r))?(n=!0,r>5&&"<br/"===e.substr(r-5,4)&&(s=0)):n&&r>0&&">"===e.charAt(r-1)&&(n=!1,r>4&&"<br/"===e.substr(r-5,4)&&(s=0)),n||"&"!==i?a&&r>0&&";"===e.charAt(r-1)&&(a=!1,s++):a=!0,n||a||(" "===i||"\n"===i||"\t"===i?s=0:s++,s>this.settings.maxWordLength&&(t+="&#8203;",s=0)),t+=i;return t},replaceBBCode:function(e){return this.settings.bbCode?e.replace(/\[(\w+)(?:=([^<>]*?))?\](.+?)\[\/\1\]/gm,this.replaceBBCodeCallback):e.replace(/\[(?:\/)?(\w+)(?:=([^<>]*?))?\]/,"")},replaceBBCodeCallback:function(e,t,s,i){if(!ajaxChat.inArray(ajaxChat.bbCodeTags,t))return e;if(ajaxChat.containsUnclosedTags(i))return e;switch(t){case"color":return ajaxChat.replaceBBCodeColor(i,s);case"url":return ajaxChat.replaceBBCodeUrl(i,s);case"img":return ajaxChat.replaceBBCodeImage(i);case"quote":return ajaxChat.replaceBBCodeQuote(i,s);case"code":return ajaxChat.replaceBBCodeCode(i);case"u":return ajaxChat.replaceBBCodeUnderline(i);default:return ajaxChat.replaceCustomBBCode(t,s,i)}},replaceBBCodeColor:function(e,t){return this.settings.bbCodeColors&&t&&this.inArray(ajaxChat.colorCodes,t)?'<span style="color:'+t+';">'+this.replaceBBCode(e)+"</span>":e},replaceBBCodeUrl:function(e,t){var s,i,n;return s=t?t.replace(/\s/gm,this.encodeText(" ")):this.stripBBCodeTags(e.replace(/\s/gm,this.encodeText(" "))),i=new RegExp("^(?:(?:http)|(?:https)|(?:ftp)|(?:irc)):\\/\\/",""),s&&s.match(i)?(this.inUrlBBCode=!0,n='<a href="'+s+'" onclick="window.open(this.href); return false;">'+this.replaceBBCode(e)+"</a>",this.inUrlBBCode=!1,n):e},replaceBBCodeImage:function(e){var t,s;return this.settings.bbCodeImages?(t=new RegExp(this.regExpMediaUrl,""),e&&e.match(t)?(e=this.stripTags(e.replace(/\s/gm,this.encodeText(" "))),s='<img class="bbCodeImage" style="max-width:'+(this.dom.chatList.offsetWidth-50)+"px; max-height:"+(this.dom.chatList.offsetHeight-50)+'px;" src="'+e+'" alt="" onload="ajaxChat.updateChatlistView();"/>',this.inUrlBBCode||(s='<a href="'+e+'" onclick="window.open(this.href); return false;">'+s+"</a>"),s):e):e},replaceBBCodeQuote:function(e,t){return t?'<span class="quote"><cite>'+this.lang.cite.replace(/%s/,t)+"</cite><q>"+this.replaceBBCode(e)+"</q></span>":'<span class="quote"><q>'+this.replaceBBCode(e)+"</q></span>"},replaceBBCodeCode:function(e){return"<code>"+this.replaceBBCode(e.replace(/\t|(?:  )/gm,"&#160;&#160;"))+"</code>"},replaceBBCodeUnderline:function(e){return'<span style="text-decoration:underline;">'+this.replaceBBCode(e)+"</span>"},replaceHyperLinks:function(e){var t;return this.settings.hyperLinks?(t=new RegExp("(^|\\s|>)((?:(?:http)|(?:https)|(?:ftp)|(?:irc)):\\/\\/[^\\s<>]+)(<\\/a>)?","gm"),e.replace(t,function(e,t,s,i){return i?e:t+'<a href="'+s+'" onclick="window.open(this.href); return false;">'+s+"</a>"})):e},replaceLineBreaks:function(e){var t=new RegExp("\\n","g");return this.settings.lineBreaks?e.replace(t,"<br/>"):e.replace(t," ")},replaceEmoticons:function(e){if(!this.settings.emoticons)return e;if(!arguments.callee.regExp){for(var t="^(.*)(",s=0;s<this.emoticonCodes.length;s++)0!==s&&(t+="|"),t+="(?:"+this.escapeRegExp(this.emoticonCodes[s])+")";t+=")(.*)$",arguments.callee.regExp=new RegExp(t,"gm")}return e.replace(arguments.callee.regExp,this.replaceEmoticonsCallback)},replaceEmoticonsCallback:function(e,t,s,i){if(arguments.callee.regExp||(arguments.callee.regExp=new RegExp('(="[^"]*$)|(&[^;]*$)',"")),t.match(arguments.callee.regExp))return e;if(s){var n=ajaxChat.arraySearch(s,ajaxChat.emoticonCodes);return ajaxChat.replaceEmoticons(t)+'<img src="'+ajaxChat.dirs.emoticons+ajaxChat.emoticonFiles[n]+'" alt="'+s+'" />'+ajaxChat.replaceEmoticons(i)}return e},getActiveStyle:function(){var e=this.readCookie(this.sessionName+"_style");return e||this.getPreferredStyleSheet()},initStyle:function(){this.styleInitiated=!0,this.setActiveStyleSheet(this.getActiveStyle())},persistStyle:function(){this.styleInitiated&&this.createCookie(this.sessionName+"_style",this.getActiveStyleSheet(),this.cookieExpiration)},setSelectedStyle:function(){if(this.dom.styleSelection)for(var e=this.getActiveStyle(),t=this.dom.styleSelection.getElementsByTagName("option"),s=0;s<t.length;s++)if(t[s].value==e){t[s].selected=!0;break}},getSelectedStyle:function(){var e=this.dom.styleSelection.getElementsByTagName("option");return-1===this.dom.styleSelection.selectedIndex?e[0].value:e[this.dom.styleSelection.selectedIndex].value},setActiveStyleSheet:function(e){var t,s,i=!1;for(t=0;s=document.getElementsByTagName("link")[t];t++)-1!==s.getAttribute("rel").indexOf("style")&&s.getAttribute("title")&&(s.disabled=!0,s.getAttribute("title")===e&&(s.disabled=!1,i=!0));i||null===e||this.setActiveStyleSheet(this.getPreferredStyleSheet())},getActiveStyleSheet:function(){var e,t;for(e=0;t=document.getElementsByTagName("link")[e];e++)if(-1!=t.getAttribute("rel").indexOf("style")&&t.getAttribute("title")&&!t.disabled)return t.getAttribute("title");return null},getPreferredStyleSheet:function(){var e,t;for(e=0;t=document.getElementsByTagName("link")[e];e++)if(-1!==t.getAttribute("rel").indexOf("style")&&-1===t.getAttribute("rel").indexOf("alt")&&t.getAttribute("title"))return t.getAttribute("title");return null},switchLanguage:function(e){window.location.search="?lang="+e},createCookie:function(e,t,s){var i="";if(s){var n=new Date;n.setTime(n.getTime()+24*s*60*60*1e3),i="; expires="+n.toGMTString()}var a="; path="+this.cookiePath,r=this.cookieDomain?"; domain="+this.cookieDomain:"",o=this.cookieSecure?"; secure":"";document.cookie=e+"="+encodeURIComponent(t)+i+a+r+o},readCookie:function(e){if(!document.cookie)return null;for(var t=e+"=",s=document.cookie.split(";"),i=0;i<s.length;i++){for(var n=s[i];" "===n.charAt(0);)n=n.substring(1,n.length);if(0===n.indexOf(t))return decodeURIComponent(n.substring(t.length,n.length))}return null},isCookieEnabled:function(){return this.createCookie(this.sessionName+"_cookie_test",!0,1),!!this.readCookie(this.sessionName+"_cookie_test")&&(this.createCookie(this.sessionName+"_cookie_test",!0,-1),!0)},finalize:function(){if("function"==typeof this.finalizeFunction&&this.finalizeFunction(),this.socket)try{this.socket.close(),this.socket=null}catch(e){this.debugMessage("finalize::closeSocket",e)}this.persistSettings(),this.persistStyle(),this.customFinalize()},initializeCustomFlashInterface:function(){},handleCustomInfoMessage:function(e,t){},customInitialize:function(){},customFinalize:function(){},getCustomUserMenuItems:function(e,t){return""},parseCustomInputMessage:function(e){return e},parseCustomInputCommand:function(e,t){return e},replaceCustomText:function(e){return e},replaceCustomCommands:function(e,t){return e},replaceCustomBBCode:function(e,t,s){return"<"+e+">"+this.replaceBBCode(s)+"</"+e+">"},customOnNewMessage:function(e,t,s,i,n,a,r,o){return!0},customSoundOnNewMessage:function(e,t,s,i,n,a,r,o){return!0},debugMessage:function(e,t){e="Ajax chat: "+e+" exception: ",this.debug&&(console.log(e,t),2===this.debug&&alert(e+t))}};
